---
title: "Data Generation"
author: "Judith Neve"
date: '2022-10-31'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(magrittr)
library(pmsampsize)
library(tidyr)
library(MASS)
library(dplyr)
```

```{r}
source("DataSimFunctions.R")
```

```{r}
n_pred         <- c(8, 16, 32)
event_fraction <- c(0.1, 0.3, 0.5)
sample_size    <- c(0.5, 1, 2)
```

```{r}
scenarios <- make_scenarios(n_pred, event_fraction, sample_size)
dat <- sim_data(scenarios, 10) # 1000 reps: 7GB - if stored as a list, 4GB
```

Now I want to do some tuning for each of these datasets

use caret (grid search), optimise accuracy, fit a random forest (and CV) for each dataset, on each dataset tune according to all the relevant combinations

```{r}
toy_dat <- dat[dat[,"dataset_id"] == "1_1",] %>%
  as.data.frame() %>% 
  pivot_wider()
```

```{r}
toy_dat <- dat[[i]][[j]]
```

```{r}
library(caret)
```

```{r}
set.seed(1)

tuneGrid <- expand.grid(
  mtry = c(1:3),
  splitrule = "gini",
  min.node.size = c(50:52)
  )
ctrl <- trainControl(
  method = "cv",
  number = 5
)
model <- train(
  x = toy_dat[,1:32],
  y = as.factor(toy_dat[,"Y"]),
  method = "ranger",
  trControl = ctrl,
  tuneGrid = tuneGrid
)
model
```

